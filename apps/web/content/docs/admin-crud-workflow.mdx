---
title: Quy trình thêm resource CRUD vào Admin
description: Hướng dẫn nhanh để thêm bảng (ví dụ Student) vào khu vực Admin, dùng Convex + Next.js + Refine.
---

> Mục tiêu: thêm một resource mới (vd: `students`) vào Admin với menu, list, create, edit và backend Convex tương ứng. Repo này đã có sẵn mẫu `todos` — bạn chỉ cần nhân bản theo quy trình dưới đây.

## 1) Backend (Convex)

- Khai báo bảng trong `packages/backend/convex/schema.ts`:

```ts
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({
  todos: defineTable({
    text: v.string(),
    completed: v.boolean(),
  }),
  // Thêm bảng students
  students: defineTable({
    name: v.string(),
    email: v.string(),
    active: v.boolean(),
  }),
});
```

- Tạo file `packages/backend/convex/students.ts` với các hàm CRUD:

```ts
import { query, mutation } from "./_generated/server";
import { v } from "convex/values";

export const getAll = query({
  handler: async (ctx) => ctx.db.query("students").collect(),
});

export const getById = query({
  args: { id: v.id("students") },
  handler: async (ctx, args) => ctx.db.get(args.id),
});

export const create = mutation({
  args: { name: v.string(), email: v.string(), active: v.boolean() },
  handler: async (ctx, args) => {
    const id = await ctx.db.insert("students", args);
    return await ctx.db.get(id);
  },
});

export const update = mutation({
  args: { id: v.id("students"), name: v.optional(v.string()), email: v.optional(v.string()), active: v.optional(v.boolean()) },
  handler: async (ctx, { id, ...patch }) => {
    await ctx.db.patch(id, patch);
    return { success: true };
  },
});

export const deleteStudent = mutation({
  args: { id: v.id("students") },
  handler: async (ctx, { id }) => {
    await ctx.db.delete(id);
    return { success: true };
  },
});
```

- Chạy Convex để sinh types (`_generated/api`): mở terminal ở `packages/backend` và chạy `pnpm dev` (hoặc `npx convex dev`).

## 2) Cấu hình Admin (menu + Refine resources)

- Mở `apps/web/src/config/adminResources.ts` và thêm cấu hình mới:

```ts
import type { Route } from "next";

export const ADMIN_RESOURCES = [
  // ... giữ nguyên todos
  {
    key: "students",
    label: "Students",
    enabled: true,
    href: "/admin/students" as Route,
    routes: {
      list: "/admin/students",
      create: "/admin/students/create",
      edit: "/admin/students/edit/:id",
    },
  },
];
```

> Lưu ý: chỉ cần bật/tắt `enabled` là menu và `<Refine resources>` sẽ tự đồng bộ.

## 3) Trang Admin (Next App Router)

Tạo 3 trang theo mẫu `todos` tại `apps/web/src/app/(admin)/admin/students`:

- `page.tsx` (List): dùng `useQuery(api.students.getAll)` để lấy dữ liệu; render bảng, nút “New” → `/admin/students/create`, nút “Edit” → `/admin/students/edit/${id}`, nút “Delete` dùng `useMutation(api.students.deleteStudent)`.
- `create/page.tsx` (Create): form state nội bộ; submit gọi `useMutation(api.students.create)`; xong `router.push("/admin/students")`.
- `edit/[id]/page.tsx` (Edit): lấy `id` bằng `useParams()` (cast về `Id<"students">`); fetch `useQuery(api.students.getById, { id })`; submit `useMutation(api.students.update)`; xong `router.push("/admin/students")`.

Bạn có thể sao chép code từ thư mục `todos` và chỉnh lại field + API.

## 4) Dùng Refine hooks? (tuỳ chọn)

Nếu muốn dùng các hook Refine (`useList/useCreate/...`) thay vì gọi trực tiếp `convex/react`, hãy mở rộng `apps/web/src/lib/refineDataProvider.ts` để hỗ trợ nhánh `students` (tương tự `todos`). Khi đó, trong các trang bạn có thể gọi `useList({ resource: "students" })`, v.v.

## 5) Link & Typed Routes

- Dùng API mới của Next Link: `import Link from "next/link";` → `<Link href="/admin/students" prefetch={false}>Students</Link>`.
- `href` trong config đã gõ kiểu `Route` nên an toàn với Typed Routes.

## 6) Kiểm tra nhanh

- Chạy Convex dev để sinh types (bắt buộc cho API mới).
- Chạy web app và vào `/admin/students`.
- Tạo, sửa, xoá một student để xác nhận flow.

## 7) Gợi ý tái sử dụng

- Tạo các component List/Form generic nhận `resourceKey` + schema để scale nhiều resource nhanh hơn.
- Thêm `accessControlProvider` (Refine) để ẩn/hiện action theo vai trò.

---

Nếu trang docs chưa thấy xuất hiện: chạy `pnpm -C apps/web postinstall` (hoặc `pnpm i` ở root) để Fumadocs cập nhật chỉ mục nguồn (`.source`).

